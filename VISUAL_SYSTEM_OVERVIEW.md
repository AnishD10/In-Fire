# π― Complete System Overview - Visual Guide

## System Architecture Diagram

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                          FRONTEND LAYER                          β”‚
β”‚                     (React Dashboard)                            β”‚
β”‚                                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚              Dashboard Components                       β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚  β”‚ System  β”‚  β”‚  Relay  β”‚  β”‚ Servo   β”‚  β”‚  LEDs   β”‚   β”‚   β”‚
β”‚  β”‚  β”‚Control  β”‚  β”‚Control  β”‚  β”‚Control  β”‚  β”‚Control  β”‚   β”‚   β”‚
β”‚  β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚   β”‚
β”‚  β”‚  β”‚Buzzer   β”‚  β”‚Integratedβ”‚ β”‚Subscriberβ”‚              β”‚   β”‚
β”‚  β”‚  β”‚Control  β”‚  β”‚Scenarios β”‚ β”‚List      β”‚              β”‚   β”‚
β”‚  β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  Total: 15+ Commands | 6 Sections                      β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                                  β”‚
β”‚              http://localhost:5173                              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                           β†“ API Call
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                       BACKEND LAYER                              β”‚
β”‚                  (Node.js + Express)                            β”‚
β”‚                                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚              API Endpoints                              β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  POST /api/control    β† Receive commands               β”‚   β”‚
β”‚  β”‚  GET  /api/dashboard  β† Send gas readings              β”‚   β”‚
β”‚  β”‚  POST /api/subscribe  β† Add subscribers                β”‚   β”‚
β”‚  β”‚  GET  /api/subscribe/list β† List subscribers           β”‚   β”‚
β”‚  β”‚  DELETE /api/subscribe/:email β† Unsubscribe            β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚              MQTT Client Service                        β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  β€Ά Subscribe: LPG/system/control                        β”‚   β”‚
β”‚  β”‚  β€Ά Publish: LPG/gas/value                              β”‚   β”‚
β”‚  β”‚  β€Ά Publish: LPG/gas/status                             β”‚   β”‚
β”‚  β”‚  β€Ά Publish: LPG/system/log                             β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚              Email Service                              β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  β€Ά SMTP: smtp.gmail.com                                 β”‚   β”‚
β”‚  β”‚  β€Ά User: manxekhatra@gmail.com                         β”‚   β”‚
β”‚  β”‚  β€Ά To: All registered subscribers                       β”‚   β”‚
β”‚  β”‚  β€Ά Template: Professional HTML                         β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                                  β”‚
β”‚              http://localhost:5000                              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                           β†“ MQTT
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                      MQTT BROKER                                 β”‚
β”‚                    (HiveMQ Cloud)                               β”‚
β”‚                                                                  β”‚
β”‚  Broker: d9224a87ae11416ebdfea8fc7ef45621.s1.eu.hivemq.cloud   β”‚
β”‚  Port: 8883 (TLS/SSL)                                          β”‚
β”‚  User: LPG_Detection                                           β”‚
β”‚                                                                  β”‚
β”‚  Topics:                                                         β”‚
β”‚  β€Ά LPG/system/control    β† Commands to ESP32                    β”‚
β”‚  β€Ά LPG/gas/value        β† Gas readings from ESP32              β”‚
β”‚  β€Ά LPG/gas/status       β† Status messages                      β”‚
β”‚  β€Ά LPG/system/log       β† Log messages                         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                           β†“ MQTT
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                       DEVICE LAYER                               β”‚
β”‚                    (ESP32 Microcontroller)                      β”‚
β”‚                                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚           Hardware Control Logic                        β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  β€Ά WiFi Connection Module                              β”‚   β”‚
β”‚  β”‚  β€Ά MQTT Client Module                                  β”‚   β”‚
β”‚  β”‚  β€Ά Command Handler Module                              β”‚   β”‚
β”‚  β”‚  β€Ά Gas Detection Module                                β”‚   β”‚
β”‚  β”‚  β€Ά Alert Management Module                             β”‚   β”‚
β”‚  β”‚  β€Ά Logging Module                                      β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚           GPIO Pin Control                              β”‚   β”‚
β”‚  β”‚                                                         β”‚   β”‚
β”‚  β”‚  GPIO 33 β”€β”€β”€β”€β”€β†’ Relay         (Gas Valve)              β”‚   β”‚
β”‚  β”‚  GPIO 14 β”€β”€β”€β”€β”€β†’ Servo (PWM)   (Vent Control)           β”‚   β”‚
β”‚  β”‚  GPIO 34 β†β”€β”€β”€β”€β”€ ADC Sensor     (Gas Measurement)       β”‚   β”‚
β”‚  β”‚  GPIO 27 β”€β”€β”€β”€β”€β†’ Buzzer        (Audio Alarm)            β”‚   β”‚
β”‚  β”‚  GPIO 25 β”€β”€β”€β”€β”€β†’ Green LED      (Status Indicator)      β”‚   β”‚
β”‚  β”‚  GPIO 26 β”€β”€β”€β”€β”€β†’ Red LED        (Alert Indicator)       β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## Command Flow Diagram

```
                    User Interaction
                          β†“
                 β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚  Frontend Button    β”‚
                 β”‚   Click Event       β”‚
                 β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                            β†“
                 β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚  React Component    β”‚
                 β”‚  handleCommand()    β”‚
                 β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                            β†“
                 β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚  API Service        β”‚
                 β”‚  sendControl()      β”‚
                 β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                            β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  HTTP POST Request          β”‚
              β”‚  /api/control               β”‚
              β”‚  {command: "RELAY_ON"}      β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  Backend Express Server     β”‚
              β”‚  Receives request           β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  MQTT Client                β”‚
              β”‚  Publishes to:              β”‚
              β”‚  LPG/system/control         β”‚
              β”‚  Message: "RELAY_ON"        β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  MQTT Broker                β”‚
              β”‚  (HiveMQ Cloud)             β”‚
              β”‚  Routes message             β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  ESP32 MQTT Subscribe       β”‚
              β”‚  Receives: "RELAY_ON"       β”‚
              β”‚  Callback triggered         β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  handle_command()           β”‚
              β”‚  Parses: "RELAY_ON"         β”‚
              β”‚  Executes function          β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  relay.on()                 β”‚
              β”‚  Sets GPIO 33 HIGH          β”‚
              β”‚  Relay switches             β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  PHYSICAL RESPONSE          β”‚
              β”‚  π’¨ Gas valve opens         β”‚
              β”‚  Relay clicks               β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  MQTT Publish Log           β”‚
              β”‚  Topic: LPG/system/log      β”‚
              β”‚  Message: "Relay ON"        β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                         β†“
              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚  Frontend Update            β”‚
              β”‚  Display confirmation       β”‚
              β”‚  Show success message       β”‚
              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## Gas Detection Flow Diagram

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  ESP32 Main Loop (Every 2 sec)  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Read Gas Sensor (GPIO 34 ADC)  β”‚
β”‚  Measure: 0-4095 scale          β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β†“
      β”β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”
      β†“             β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ < 1200    β”‚  β”‚  >= 1200     β”‚
β”‚ (Normal)  β”‚  β”‚ (Gas Alert)  β”‚
β””β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
      β†“               β†“
 β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
 β”‚NORMAL   β”‚    β”‚ALERT MODE TRIGGEREDβ”‚
 β”‚MODE     β”‚    β”‚                    β”‚
 β”‚β”€β”€β”€β”€β”€β”€β”€β”€β”‚    β”‚β€Ά Red LED ON        β”‚
 β”‚β“Green ONβ”‚    β”‚β€Ά Relay OFF         β”‚
 β”‚β“Relay ONβ”‚    β”‚β€Ά Servo 90Β°         β”‚
 β”‚β“Servo 0Β°β”‚    β”‚β€Ά Buzzer ON         β”‚
 β”‚β“Buzzer  β”‚    β”‚β€Ά Email sent        β”‚
 β”‚ OFF     β”‚    β”‚β€Ά Hold 10 seconds   β”‚
 β””β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚                  β”‚
      β”‚                  β†“
      β”‚         β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚         β”‚ Publish to MQTT β”‚
      β”‚         β”‚ LPG/gas/status  β”‚
      β”‚         β”‚ "GAS_DETECTED"  β”‚
      β”‚         β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚                  β”‚
      β”‚                  β†“
      β”‚         β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚         β”‚ Backend receivesβ”‚
      β”‚         β”‚ Triggers emails β”‚
      β”‚         β”‚ to subscribers  β”‚
      β”‚         β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚                  β”‚
      β”‚                  β†“
      β”‚         β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚         β”‚ Email Service   β”‚
      β”‚         β”‚ Nodemailer +    β”‚
      β”‚         β”‚ Gmail SMTP      β”‚
      β”‚         β”‚ Send to all     β”‚
      β”‚         β”‚ subscribers     β”‚
      β”‚         β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚                  β”‚
      β”‚                  β†“
      β”‚         β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚         β”‚ Wait 10 seconds β”‚
      β”‚         β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
      β”‚                  β”‚
      β†“                  β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Check gas level again        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
      β†“
      β””β”€β†’ If < 1200 β†’ Return to NORMAL MODE
          If >= 1200 β†’ Stay in ALERT MODE
```

## Hardware Connection Diagram

```
           β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
           β”‚   ESP32 DevKit β”‚
           β”‚       V1       β”‚
           β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β†“ β†“ β†“ β†“ β†“ β†“
     β”β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚ β”‚ β”‚ β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”
     β”‚          β”‚ β”‚ β”‚ β”‚          β”‚
     β†“          β†“ β†“ β†“ β†“          β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”
β”‚ Relay   β”‚ β”‚Servo β”‚ β”‚Buzzerβ”‚ β”‚ LEDs β”‚
β”‚ GPIO 33 β”‚ β”‚GPIO14β”‚ β”‚GPIO27β”‚ β”‚25,26 β”‚
β””β”€β”€β”€β”€β”¬β”€β”€β”€β”€β” β””β”€β”€β”¬β”€β”€β”€β” β””β”€β”€β”¬β”€β”€β”€β” β””β”€β”€β”¬β”€β”€β”€β”
     β”‚        PWM 50Hz  β”‚       (3.3V)
     β”‚    (5V supply)   β”‚
     β†“                  β†“
  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  β”‚Gas Valve β”‚   β”‚Vent Ctrl β”‚
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚    Gas Sensor (MQ-2)        β”‚
β”‚    GPIO 34 (ADC)            β”‚
β”‚    Reads: 0-4095 ADC        β”‚
β”‚    Normal: 300-500 ADC      β”‚
β”‚    Alert: > 1200 ADC        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

              5V Power Supply
              β”β”€β†’ Relay Module
              β”β”€β†’ Servo Motor
              β”β”€β†’ MQ-2 Sensor
              β”β”€β†’ Buzzer
              β””β”€β†’ LEDs (via resistors)
```

## Command Summary Table

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚           COMMAND EXECUTION MAPPING                             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Button Text        β”‚ MQTT Command    β”‚ GPIO  β”‚ Physical Effect β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ System ON          β”‚ ON              β”‚ -     β”‚ normal_mode()   β”‚
β”‚ System OFF         β”‚ OFF             β”‚ -     β”‚ all_off()       β”‚
β”‚ Test Alert         β”‚ TEST            β”‚ -     β”‚ test_alert()    β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Fan ON             β”‚ RELAY_ON        β”‚ 33    β”‚ relay.on()      β”‚
β”‚ Fan OFF            β”‚ RELAY_OFF       β”‚ 33    β”‚ relay.off()     β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Servo 0Β°           β”‚ SERVO_0         β”‚ 14    β”‚ duty(38)        β”‚
β”‚ Servo 90Β°          β”‚ SERVO_90        β”‚ 14    β”‚ duty(77)        β”‚
β”‚ Servo 180Β°         β”‚ SERVO_180       β”‚ 14    β”‚ duty(115)       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Green LED ON       β”‚ LED_GREEN       β”‚ 25    β”‚ on()            β”‚
β”‚ Red LED ON         β”‚ LED_RED         β”‚ 26    β”‚ on()            β”‚
β”‚ All LEDs OFF       β”‚ LED_OFF         β”‚ 25,26 β”‚ off()           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Buzzer ON          β”‚ BUZZER_ON       β”‚ 27    β”‚ on()            β”‚
β”‚ Buzzer OFF         β”‚ BUZZER_OFF      β”‚ 27    β”‚ off()           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Srv+Fan            β”‚ SERVO_WITH_FAN  β”‚ Multi β”‚ Emergency seq   β”‚
β”‚ Full Alert         β”‚ ALERT_MODE      β”‚ Multi β”‚ Alert sequence  β”‚
β”‚ Normal Mode        β”‚ NORMAL_MODE     β”‚ Multi β”‚ Normal sequence β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## System States Diagram

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚       NORMAL STATE           β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚ β“ Green LED: ON        β”‚  β”‚
β”‚  β”‚ β“ Red LED: OFF         β”‚  β”‚
β”‚  β”‚ β“ Relay: ON            β”‚  β”‚
β”‚  β”‚ β“ Servo: 0Β°            β”‚  β”‚
β”‚  β”‚ β“ Buzzer: OFF          β”‚  β”‚
β”‚  β”‚ β“ Gas: < 1200 ADC      β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
            β†“
       Gas Detected
       (> 1200 ADC)
            β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚       ALERT STATE            β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚ β— Green LED: OFF       β”‚  β”‚
β”‚  β”‚ β— Red LED: ON          β”‚  β”‚
β”‚  β”‚ β— Relay: OFF           β”‚  β”‚
β”‚  β”‚ β— Servo: 90Β°           β”‚  β”‚
β”‚  β”‚ β— Buzzer: ON           β”‚  β”‚
β”‚  β”‚ β— Email: SENT          β”‚  β”‚
β”‚  β”‚ β— Hold: 10 seconds     β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
            β†“
     Gas Back to Normal
       (< 1200 ADC)
            β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚      RECOVERY STATE          β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚ β“ Green LED: ON        β”‚  β”‚
β”‚  β”‚ β“ Red LED: OFF         β”‚  β”‚
β”‚  β”‚ β“ Relay: ON            β”‚  β”‚
β”‚  β”‚ β“ Servo: 0Β°            β”‚  β”‚
β”‚  β”‚ β“ Buzzer: OFF          β”‚  β”‚
β”‚  β”‚ β“ Status: NORMAL       β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

**Visual System Overview Complete** β…
